<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="data.validator">
<title>Targets validation workflow • data.validator</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Targets validation workflow">
<meta property="og:description" content="data.validator">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Google tag (gtag.js) --><script async src="https://www.googletagmanager.com/gtag/js?id=G-FVQKL0FR02"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-FVQKL0FR02');
</script><!-- Google tag (gtag.js) --><script async src="https://www.googletagmanager.com/gtag/js?id=G-FQQZL5V93G"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-FQQZL5V93G');
</script><script async defer src="https://buttons.github.io/buttons.js"></script>
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">data.validator</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.0.9000</small>

    <a href="https://shiny.tools" class="external-link home"><i class="fa fa-lg fa-chevron-left"></i></a>

    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../index.html">
    <span class="fa fa-home"></span>
     
    Start
  </a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown--articles">
    <span class="fa fa-university"></span>
     
    Articles
  </a>
  <div class="dropdown-menu" aria-labelledby="dropdown--articles">
    <a class="dropdown-item" href="../articles/data_validator.html">All you need to know about data.validator</a>
    <a class="dropdown-item" href="../articles/targets_workflow.html">Targets validation workflow</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">
    <span class="fa fa-file-code-o"></span>
     
    Reference
  </a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/Appsilon/data.validator">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
<li class="nav-item">
  <a class="external-link nav-link" href="https://twitter.com/Appsilon">
    <span class="fa fa-twitter fa-lg"></span>
     
  </a>
</li>
<li class="nav-item">
  <a class="external-link nav-link" href="https://fosstodon.org/@appsilon">
    <span class="fab fa fab fa-mastodon fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">



<script src="targets_workflow_files/htmlwidgets-1.6.2/htmlwidgets.js"></script><link href="targets_workflow_files/vis-9.1.0/vis-network.min.css" rel="stylesheet">
<script src="targets_workflow_files/vis-9.1.0/vis-network.min.js"></script><script src="targets_workflow_files/visNetwork-binding-2.1.2/visNetwork.js"></script><div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Targets validation workflow</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/Appsilon/data.validator/blob/HEAD/vignettes/targets_workflow.Rmd" class="external-link"><code>vignettes/targets_workflow.Rmd</code></a></small>
      <div class="d-none name"><code>targets_workflow.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>Data validation is an essential step in ensuring the reliability and
accuracy of data. Businesses can reduce the risks associated with “bad”
data and make well-informed decisions by following best practices such
as using validation rules, developing routines and workflows, automating
operations, and monitoring data quality.</p>
<p>Incorporating data validation rules into a data pipeline is of
crucial importance because they can prevent data errors spreading
farther down the pipeline, and to other downstream applications where
they may be more difficult to detect. Without data validation rules, it
can be challenging to determine which data caused the error, or it might
not appear at all as a data error; or, in the worst cases, violations
might go undetected and generate inaccurate results for your dashboards
and reports.</p>
<p>This tutorial shows how to combine the R package
<code>targets</code>, which orchestrates the components of
computationally intensive analysis projects, with
<code>data.validator</code>, which is a tool for data validation and
reporting.</p>
<p>Although the subject of data validation is very broad, we will
concentrate on two key ideas:</p>
<ul>
<li><p><strong>Metadata validation</strong> with an example of a
defensive approach that ‘fails fast’ and generates a well handled error
response. Having a ‘fine-grained’ error handling, we can perform
important actions like send an email, store validation data to a
database for analysis, or publish an HTML report generated by
<code>data.validator</code> to Posit Connect.</p></li>
<li><p><strong>Domain expertise knowledge</strong> and
<strong>error-localization</strong> that is an essential ingredient to
any data curation process. We demonstrate a simple example of a data
workflow where <code>data.validator</code> is the ‘pedal force’ of a
data cleansing and imputation process.</p></li>
</ul>
</div>
<div class="section level2">
<h2 id="file-structure">File structure<a class="anchor" aria-label="anchor" href="#file-structure"></a>
</h2>
<p><code>targets</code> is an opinionated framework to organize your
data workflows. For our purposes, the file structure of the targets
project looks like:</p>
<pre><code>├── _targets.R
├── data.csv
├── schema.csv
├── R/
│   ├── functions.R</code></pre>
<ul>
<li><p><code>data.csv</code> contains the data that we want to
analyze.</p></li>
<li><p><code>schema.csv</code> contains the schema that will be used to
assert the data structure.</p></li>
<li><p><code>R/functions.R</code> contains our custom user-defined
functions.</p></li>
<li><p><code>_targets.R</code> is the special file that defines the
<code>targets</code> workflow.</p></li>
</ul>
<div class="section level3">
<h3 id="dependencies">Dependencies<a class="anchor" aria-label="anchor" href="#dependencies"></a>
</h3>
<p>To run the code in this tutorial, the following libraries must be
installed:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/targets/" class="external-link">targets</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://readr.tidyverse.org" class="external-link">readr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://appsilon.github.io/data.validator/">data.validator</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rlang.r-lib.org" class="external-link">rlang</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://purrr.tidyverse.org/" class="external-link">purrr</a></span><span class="op">)</span></span></code></pre></div>
<p>When the pipeline is executed <code>targets</code> performs all
computation in a separate R process using <code><a href="https://callr.r-lib.org/reference/r.html" class="external-link">callr::r()</a></code>. To
define the packages that should be loaded in that process the
<code><a href="https://docs.ropensci.org/targets/reference/tar_option_set.html" class="external-link">tar_option_set()</a></code> function is used in the
<code>_targets.R</code> script.</p>
</div>
<div class="section level3">
<h3 id="input-data">Input data<a class="anchor" aria-label="anchor" href="#input-data"></a>
</h3>
<p>Let’s consider the <code>iris</code> dataset with some tweaks in
order to work with different data validation concepts. We perform the
following mutations:</p>
<ol style="list-style-type: decimal">
<li>Add an index column</li>
<li>Add a few outliers</li>
</ol>
<p>and save to a CSV file that will be tracked as a data input by the
pipeline.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://readr.tidyverse.org" class="external-link">readr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">input_data</span> <span class="op">&lt;-</span> <span class="va">iris</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    index <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">iris</span><span class="op">)</span>,</span>
<span>    Sepal.Width <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span><span class="va">Sepal.Width</span> <span class="op">&gt;</span> <span class="fl">4</span>, <span class="fl">999</span>, <span class="va">Sepal.Width</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://readr.tidyverse.org/reference/write_delim.html" class="external-link">write_csv</a></span><span class="op">(</span><span class="va">input_data</span>, <span class="st">"data.csv"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="data-structure">Data structure<a class="anchor" aria-label="anchor" href="#data-structure"></a>
</h3>
<p>Let’s get the table’s schema and save it as a CSV file. This file and
the related data can be considered as inputs in the data pipeline.
Saving the input table’s expected schema to a file can aid with early
error detection due to schema changes, is simple to share, and can be
versioned. Changes to the schema file can be tracked by the targets
pipeline, and any stages that depend on it upstream will be
invalidated.</p>
<p>We save the schema as a CSV with two columns. <code>name</code>
stands for the name of the columns, and <code>type</code> stands for
their class:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://readr.tidyverse.org" class="external-link">readr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://purrr.tidyverse.org/" class="external-link">purrr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://magrittr.tidyverse.org" class="external-link">magrittr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">get_schema</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://purrr.tidyverse.org/reference/map_dfr.html" class="external-link">imap_dfr</a></span><span class="op">(</span><span class="va">data</span>, \<span class="op">(</span><span class="va">var</span>, <span class="va">name</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>      name <span class="op">=</span> <span class="va">name</span>,</span>
<span>      type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">var</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu">get_schema</span><span class="op">(</span><span class="va">input_data</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/tee.html" class="external-link">%T&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://readr.tidyverse.org/reference/write_delim.html" class="external-link">write_csv</a></span><span class="op">(</span><span class="st">"schema.csv"</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 2</span></span></span>
<span><span class="co">#&gt;   name         type   </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> Sepal.Length numeric</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> Sepal.Width  numeric</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> Petal.Length numeric</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> Petal.Width  numeric</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> Species      factor </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> index        integer</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="metadata-validation">Metadata validation<a class="anchor" aria-label="anchor" href="#metadata-validation"></a>
</h2>
<p>Analyzing metadata, such as the dimensions of a table or the presence
of specific variables, is a crucial component of data validation.
Typically, access to the complete dataset is needed in order to test
metadata. <code>data.validator</code> has the <code><a href="../reference/validate_if.html">validate_if()</a></code>
function that can confirm assertions on the data structure
<em>itself</em>.</p>
<p>Some typical examples are:</p>
<ol style="list-style-type: decimal">
<li>Check column names with <code><a href="https://docs.ropensci.org/assertr/reference/has_all_names.html" class="external-link">has_all_names()</a></code>,
<code><a href="https://docs.ropensci.org/assertr/reference/has_only_names.html" class="external-link">has_only_names()</a></code>
</li>
<li>Check the class of columns with <code><a href="https://docs.ropensci.org/assertr/reference/has_class.html" class="external-link">has_class()</a></code>
</li>
<li>Check the dimensions of the table with a custom expression</li>
</ol>
<p>We need three functions for our simple metadata validation pipeline.
The first, reads data and the schema from the CSV files that we wrote to
disk in previous sections. The second validates the data structure by
utilizing the stored schema file. The third checks the pipeline for
violations and terminates in a controlled way by using a user-defined
custom error class.</p>
<p>The script that contains the functions for computing the pipeline
“targets” reads:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># R/functions.R</span></span>
<span></span>
<span><span class="co"># The namespace of the process that executes these functions is defined</span></span>
<span><span class="co"># in the `_targets.R` file where the following libraries are loaded:</span></span>
<span><span class="co">#</span></span>
<span><span class="co"># tar_option_set(</span></span>
<span><span class="co">#   packages = c("readr", "dplyr", "data.validator", "assertr", "rlang",</span></span>
<span><span class="co">#                "purrr")</span></span>
<span><span class="co"># )</span></span>
<span></span>
<span><span class="va">get_data</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">file</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">read_csv</a></span><span class="op">(</span><span class="va">file</span>, col_types <span class="op">=</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/cols.html" class="external-link">cols</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">metadata_validator</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">schema</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://docs.ropensci.org/targets/reference/tar_assert.html" class="external-link">tar_assert_identical</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">schema</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"name"</span>, <span class="st">"type"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">report</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/data_validation_report.html">data_validation_report</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span>  <span class="fu"><a href="../reference/validate.html">validate</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/validate_if.html">validate_if</a></span><span class="op">(</span></span>
<span>      <span class="fu"><a href="https://docs.ropensci.org/assertr/reference/has_all_names.html" class="external-link">has_all_names</a></span><span class="op">(</span><span class="op">!</span><span class="op">!</span><span class="op">!</span><span class="va">schema</span><span class="op">$</span><span class="va">name</span><span class="op">)</span>,</span>
<span>      description <span class="op">=</span> <span class="st">"Columns exist"</span></span>
<span>    <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/add_results.html">add_results</a></span><span class="op">(</span><span class="va">report</span><span class="op">)</span></span>
<span></span>
<span>  <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">walk</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">schema</span><span class="op">$</span><span class="va">type</span><span class="op">)</span>, \<span class="op">(</span><span class="va">col_class</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu">validate_column_class</span><span class="op">(</span><span class="va">col_class</span>, <span class="va">schema</span>, <span class="va">data</span>, <span class="va">report</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">report</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">validation_violation</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">report</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">violations_exist</span> <span class="op">&lt;-</span> <span class="va">report</span><span class="op">$</span><span class="fu">get_validations</span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">num.violations</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span></span>
<span>    <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Logic.html" class="external-link">isTRUE</a></span><span class="op">(</span><span class="va">violations_exist</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rlang.r-lib.org/reference/abort.html" class="external-link">abort</a></span><span class="op">(</span></span>
<span>      <span class="st">"Validation schema error"</span>,</span>
<span>      body <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/utils/capture.output.html" class="external-link">capture.output</a></span><span class="op">(</span><span class="va">report</span><span class="op">)</span>,</span>
<span>      class <span class="op">=</span> <span class="st">"validation_violation"</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="cn">FALSE</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># utility lambda function</span></span>
<span><span class="va">validate_column_class</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">col_class</span>, <span class="va">schema</span>, <span class="va">data</span>, <span class="va">report</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">var_names</span> <span class="op">&lt;-</span> <span class="va">schema</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">type</span> <span class="op">==</span> <span class="va">col_class</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">name</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="../reference/validate.html">validate</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/validate_if.html">validate_if</a></span><span class="op">(</span></span>
<span>      <span class="fu"><a href="https://docs.ropensci.org/assertr/reference/has_class.html" class="external-link">has_class</a></span><span class="op">(</span><span class="op">!</span><span class="op">!</span><span class="op">!</span><span class="va">var_names</span>, class <span class="op">=</span> <span class="op">{</span><span class="op">{</span> <span class="va">col_class</span> <span class="op">}</span><span class="op">}</span><span class="op">)</span>,</span>
<span>      description <span class="op">=</span> <span class="fu">glue</span><span class="fu">::</span><span class="fu"><a href="https://glue.tidyverse.org/reference/glue.html" class="external-link">glue</a></span><span class="op">(</span><span class="st">"Column classes: {col_class}"</span><span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/add_results.html">add_results</a></span><span class="op">(</span><span class="va">report</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<ul>
<li><p><code>get_data()</code> reads data from disk, and we purposefully
omit to specify the column types. A validation error will result from
this because, for instance, the column <code>Species</code> will be read
as a <code>character</code> rather than a <code>factor</code> that is
present in the original table.</p></li>
<li>
<p><code>metadata_validator()</code> uses the <code>schema</code>
table stored in <code>schema.csv</code> and <code>rlang</code>
meta-programming tools to dynamically verify the data structure of the
imported data. We run two separate checks on the data structure using
<code><a href="../reference/validate_if.html">validate_if()</a></code>:</p>
<ul>
<li><p>All column names provided in the schema are present in the
data.</p></li>
<li><p>The column classes in the schema table comply to when we read the
<code>data.csv</code> file from disk.</p></li>
</ul>
</li>
<li><p><code>validation_violation()</code> checks for validation
violations in the <code>Report</code> object returned by the
<code>data.validator</code>. Following a defensive approach we <em>‘fail
fast’</em> in case of a violation, to protect downstream steps to be
invalidated or produce an uncontrolled error. Furthermore, we are using
an error with <em>classed condition</em> that can be handled
selectively, allowing for fine-grained error handling.</p></li>
</ul>
<p>The <code>targets</code> script file for metadata validation looks
like:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># _targets.R file</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/targets/" class="external-link">targets</a></span><span class="op">)</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/source.html" class="external-link">source</a></span><span class="op">(</span><span class="st">"R/functions.R"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://docs.ropensci.org/targets/reference/tar_option_set.html" class="external-link">tar_option_set</a></span><span class="op">(</span></span>
<span>  packages <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"readr"</span>, <span class="st">"dplyr"</span>, <span class="st">"data.validator"</span>, <span class="st">"assertr"</span>, <span class="st">"rlang"</span>,</span>
<span>               <span class="st">"purrr"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://docs.ropensci.org/targets/reference/tar_target.html" class="external-link">tar_target</a></span><span class="op">(</span><span class="va">data_file</span>, <span class="st">"data.csv"</span>, format <span class="op">=</span> <span class="st">"file"</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://docs.ropensci.org/targets/reference/tar_target.html" class="external-link">tar_target</a></span><span class="op">(</span><span class="va">input_data</span>, <span class="fu">get_data</span><span class="op">(</span><span class="va">data_file</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://docs.ropensci.org/targets/reference/tar_target.html" class="external-link">tar_target</a></span><span class="op">(</span><span class="va">schema_file</span>, <span class="st">"schema.csv"</span>, format <span class="op">=</span> <span class="st">"file"</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://docs.ropensci.org/targets/reference/tar_target.html" class="external-link">tar_target</a></span><span class="op">(</span><span class="va">schema</span>, <span class="fu">get_data</span><span class="op">(</span><span class="va">schema_file</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://docs.ropensci.org/targets/reference/tar_target.html" class="external-link">tar_target</a></span><span class="op">(</span></span>
<span>    <span class="va">metadata_validation</span>,</span>
<span>    <span class="fu">metadata_validator</span><span class="op">(</span><span class="va">input_data</span>, <span class="va">schema</span><span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://docs.ropensci.org/targets/reference/tar_target.html" class="external-link">tar_target</a></span><span class="op">(</span><span class="va">is_violation</span>, <span class="fu">validation_violation</span><span class="op">(</span><span class="va">metadata_validation</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="running-the-pipeline">Running the pipeline<a class="anchor" aria-label="anchor" href="#running-the-pipeline"></a>
</h3>
<p>Before we run the pipeline we can inspect it for obvious errors by
displaying the dependency graph, showing a natural left-to-right flow of
work, and giving feedback on the state of each “target”:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">targets</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/targets/reference/tar_visnetwork.html" class="external-link">tar_visnetwork</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="visNetwork html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-3defbab9a535912c67b0" style="width:100%;height:432.632880098888px;"></div>
<script type="application/json" data-for="htmlwidget-3defbab9a535912c67b0">{"x":{"nodes":{"name":["data_file","input_data","is_violation","metadata_validation","schema","schema_file","get_data","validate_column_class","validation_violation","metadata_validator"],"type":["stem","stem","stem","stem","stem","stem","function","function","function","function"],"status":["outdated","outdated","outdated","outdated","outdated","outdated","outdated","outdated","outdated","outdated"],"seconds":[null,null,null,null,null,null,null,null,null,null],"bytes":[null,null,null,null,null,null,null,null,null,null],"branches":[null,null,null,null,null,null,null,null,null,null],"label":["data_file","input_data","is_violation","metadata_validation","schema","schema_file","get_data","validate_column_class","validation_violation","metadata_validator"],"color":["#78B7C5","#78B7C5","#78B7C5","#78B7C5","#78B7C5","#78B7C5","#78B7C5","#78B7C5","#78B7C5","#78B7C5"],"id":["data_file","input_data","is_violation","metadata_validation","schema","schema_file","get_data","validate_column_class","validation_violation","metadata_validator"],"level":[1,2,4,3,2,1,1,1,1,2],"shape":["dot","dot","dot","dot","dot","dot","triangle","triangle","triangle","triangle"]},"edges":{"from":["validate_column_class","metadata_validation","validation_violation","input_data","metadata_validator","schema","data_file","get_data","get_data","schema_file"],"to":["metadata_validator","is_violation","is_violation","metadata_validation","metadata_validation","metadata_validation","input_data","input_data","schema","schema"],"arrows":["to","to","to","to","to","to","to","to","to","to"]},"nodesToDataframe":true,"edgesToDataframe":true,"options":{"width":"100%","height":"100%","nodes":{"shape":"dot","physics":false},"manipulation":{"enabled":false},"edges":{"smooth":{"type":"cubicBezier","forceDirection":"horizontal"}},"physics":{"stabilization":false},"interaction":{"zoomSpeed":1},"layout":{"hierarchical":{"enabled":true,"direction":"LR"}}},"groups":null,"width":null,"height":null,"idselection":{"enabled":false,"style":"width: 150px; height: 26px","useLabels":true,"main":"Select by id"},"byselection":{"enabled":false,"style":"width: 150px; height: 26px","multiple":false,"hideColor":"rgba(200,200,200,0.5)","highlight":false},"main":{"text":"","style":"font-family:Georgia, Times New Roman, Times, serif;font-weight:bold;font-size:20px;text-align:center;"},"submain":null,"footer":null,"background":"rgba(0, 0, 0, 0)","highlight":{"enabled":true,"hoverNearest":false,"degree":{"from":1,"to":1},"algorithm":"hierarchical","hideColor":"rgba(200,200,200,0.5)","labelOnly":true},"collapse":{"enabled":true,"fit":false,"resetHighlight":true,"clusterOptions":null,"keepCoord":true,"labelSuffix":"(cluster)"},"legend":{"width":0.2,"useGroups":false,"position":"right","ncol":1,"stepX":100,"stepY":100,"zoom":true,"nodes":{"label":["Outdated","Stem","Function"],"color":["#78B7C5","#899DA4","#899DA4"],"shape":["dot","dot","triangle"]},"nodesToDataframe":true},"tooltipStay":300,"tooltipStyle":"position: fixed;visibility:hidden;padding: 5px;white-space: nowrap;font-family: verdana;font-size:14px;font-color:#000000;background-color: #f5f4ed;-moz-border-radius: 3px;-webkit-border-radius: 3px;border-radius: 3px;border: 1px solid #808074;box-shadow: 3px 3px 10px rgba(0, 0, 0, 0.2);"},"evals":[],"jsHooks":[]}</script><p>We run the pipeline and control for a validation error using the
custom error class that indicates a violation on the schema. The
violations are treated as an ‘unusual condition’ with
<code><a href="https://rdrr.io/r/base/conditions.html" class="external-link">tryCatch()</a></code> and a report is generated using
<code><a href="../reference/save_report.html">data.validator::save_report()</a></code> that you can send to email,
store in logs folder, or publish to Posit Connect using the R package
<code>connectapi</code>.</p>
<p>In this example in case of <code>validation_violation</code>
condition appears, we save an HTML report to disk and render the
Directed Acyclic Graph that indicates the error:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/targets/" class="external-link">targets</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://appsilon.github.io/data.validator/">data.validator</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">tar_make_catch</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/conditions.html" class="external-link">tryCatch</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://docs.ropensci.org/targets/reference/tar_make.html" class="external-link">tar_make</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    validation_violation <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">e</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="fu"><a href="https://docs.ropensci.org/targets/reference/tar_read.html" class="external-link">tar_read</a></span><span class="op">(</span><span class="st">"metadata_validation"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="../reference/save_report.html">save_report</a></span><span class="op">(</span><span class="op">)</span></span>
<span>      <span class="fu"><a href="https://docs.ropensci.org/targets/reference/tar_visnetwork.html" class="external-link">tar_visnetwork</a></span><span class="op">(</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu">tar_make_catch</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">▶ start target data_file</span></span></span>
<span><span class="co"><span style="color: #BB0000;">#&gt; ● built target data_file [0.206 seconds]</span></span></span>
<span><span class="co"><span style="color: #BB0000;">#&gt; ▶ start target schema_file</span></span></span>
<span><span class="co"><span style="color: #BB0000;">#&gt; ● built target schema_file [0 seconds]</span></span></span>
<span><span class="co"><span style="color: #BB0000;">#&gt; ▶ start target input_data</span></span></span>
<span><span class="co"><span style="color: #BB0000;">#&gt; ● built target input_data [0.135 seconds]</span></span></span>
<span><span class="co"><span style="color: #BB0000;">#&gt; ▶ start target schema</span></span></span>
<span><span class="co"><span style="color: #BB0000;">#&gt; ● built target schema [0.006 seconds]</span></span></span>
<span><span class="co"><span style="color: #BB0000;">#&gt; ▶ start target metadata_validation</span></span></span>
<span><span class="co"><span style="color: #BB0000;">#&gt; ● built target metadata_validation [0.16 seconds]</span></span></span>
<span><span class="co"><span style="color: #BB0000;">#&gt; ▶ start target is_violation</span></span></span>
<span><span class="co"><span style="color: #BB0000;">#&gt; ✖ error target is_violation</span></span></span>
<span><span class="co"><span style="color: #BB0000;">#&gt; ▶ end pipeline [0.693 seconds]</span></span></span>
<span><span class="co"><span style="color: #BB0000;">#&gt; </span></span></span></code></pre></div>
<div class="visNetwork html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-9a3f9bcf91fc6158ba5a" style="width:100%;height:432.632880098888px;"></div>
<script type="application/json" data-for="htmlwidget-9a3f9bcf91fc6158ba5a">{"x":{"nodes":{"name":["data_file","input_data","is_violation","metadata_validation","schema","schema_file","get_data","validate_column_class","validation_violation","metadata_validator"],"type":["stem","stem","stem","stem","stem","stem","function","function","function","function"],"status":["uptodate","uptodate","errored","uptodate","uptodate","uptodate","uptodate","uptodate","uptodate","uptodate"],"seconds":[0.206,0.135,0.048,0.16,0.006,0,null,null,null,null],"bytes":[4214,1597,0,5087,335,121,null,null,null,null],"branches":[null,null,null,null,null,null,null,null,null,null],"label":["data_file","input_data","is_violation","metadata_validation","schema","schema_file","get_data","validate_column_class","validation_violation","metadata_validator"],"color":["#354823","#354823","#C93312","#354823","#354823","#354823","#354823","#354823","#354823","#354823"],"id":["data_file","input_data","is_violation","metadata_validation","schema","schema_file","get_data","validate_column_class","validation_violation","metadata_validator"],"level":[1,2,4,3,2,1,1,1,1,2],"shape":["dot","dot","dot","dot","dot","dot","triangle","triangle","triangle","triangle"]},"edges":{"from":["validate_column_class","metadata_validation","validation_violation","input_data","metadata_validator","schema","data_file","get_data","get_data","schema_file"],"to":["metadata_validator","is_violation","is_violation","metadata_validation","metadata_validation","metadata_validation","input_data","input_data","schema","schema"],"arrows":["to","to","to","to","to","to","to","to","to","to"]},"nodesToDataframe":true,"edgesToDataframe":true,"options":{"width":"100%","height":"100%","nodes":{"shape":"dot","physics":false},"manipulation":{"enabled":false},"edges":{"smooth":{"type":"cubicBezier","forceDirection":"horizontal"}},"physics":{"stabilization":false},"interaction":{"zoomSpeed":1},"layout":{"hierarchical":{"enabled":true,"direction":"LR"}}},"groups":null,"width":null,"height":null,"idselection":{"enabled":false,"style":"width: 150px; height: 26px","useLabels":true,"main":"Select by id"},"byselection":{"enabled":false,"style":"width: 150px; height: 26px","multiple":false,"hideColor":"rgba(200,200,200,0.5)","highlight":false},"main":{"text":"","style":"font-family:Georgia, Times New Roman, Times, serif;font-weight:bold;font-size:20px;text-align:center;"},"submain":null,"footer":null,"background":"rgba(0, 0, 0, 0)","highlight":{"enabled":true,"hoverNearest":false,"degree":{"from":1,"to":1},"algorithm":"hierarchical","hideColor":"rgba(200,200,200,0.5)","labelOnly":true},"collapse":{"enabled":true,"fit":false,"resetHighlight":true,"clusterOptions":null,"keepCoord":true,"labelSuffix":"(cluster)"},"legend":{"width":0.2,"useGroups":false,"position":"right","ncol":1,"stepX":100,"stepY":100,"zoom":true,"nodes":{"label":["Up to date","Errored","Stem","Function"],"color":["#354823","#C93312","#899DA4","#899DA4"],"shape":["dot","dot","dot","triangle"]},"nodesToDataframe":true},"tooltipStay":300,"tooltipStyle":"position: fixed;visibility:hidden;padding: 5px;white-space: nowrap;font-family: verdana;font-size:14px;font-color:#000000;background-color: #f5f4ed;-moz-border-radius: 3px;-webkit-border-radius: 3px;border-radius: 3px;border: 1px solid #808074;box-shadow: 3px 3px 10px rgba(0, 0, 0, 0.2);"},"evals":[],"jsHooks":[]}</script>
</div>
<div class="section level3">
<h3 id="fixing-the-data-structure-error">Fixing the data structure error<a class="anchor" aria-label="anchor" href="#fixing-the-data-structure-error"></a>
</h3>
<p>The pipeline “errored out” due to differences in the schema and the
imported file. The good news is that we can return to previous computed
“targets” and inspect what caused the error. <code>targets</code>
provide strong evidence for reproducibility, by caching already computed
steps.</p>
<p>We can inspect the report object calculated in the
<code>metadata_validation</code> “target”:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">targets</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/targets/reference/tar_read.html" class="external-link">tar_read</a></span><span class="op">(</span><span class="st">"metadata_validation"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Validation summary: </span></span>
<span><span class="co">#&gt;  Number of successful validations: 2</span></span>
<span><span class="co">#&gt;  Number of validations with warnings: 0</span></span>
<span><span class="co">#&gt;  Number of failed validations: 2</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Advanced view: </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; |table_name |description             |type    | total_violations|</span></span>
<span><span class="co">#&gt; |:----------|:-----------------------|:-------|----------------:|</span></span>
<span><span class="co">#&gt; |data       |Column classes: factor  |error   |                1|</span></span>
<span><span class="co">#&gt; |data       |Column classes: integer |error   |                1|</span></span>
<span><span class="co">#&gt; |data       |Column classes: numeric |success |               NA|</span></span>
<span><span class="co">#&gt; |data       |Columns exist           |success |               NA|</span></span></code></pre></div>
<p>The error indicates that the factor, and integer column checks
failed. As we already mentioned, this is expected since in
<code><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">read_csv()</a></code> we read the data without indicating the column
types, resulting into an unexpected data structure compared to the
‘accepted’ schema.</p>
<p>Suppose a not-so-ideal scenario that we have to accept the new data
structure of the input data, where the columns <code>index</code>, and
<code>Species</code> are numeric, and character respectively. To fix the
validation failures we’ll have to update the schema file as follows:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/targets/" class="external-link">targets</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://magrittr.tidyverse.org" class="external-link">magrittr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://docs.ropensci.org/targets/reference/tar_read.html" class="external-link">tar_read</a></span><span class="op">(</span><span class="st">"schema"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    type <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span></span>
<span>      <span class="va">name</span> <span class="op">==</span> <span class="st">"Species"</span> <span class="op">~</span> <span class="st">"character"</span>,</span>
<span>      <span class="va">name</span> <span class="op">==</span> <span class="st">"index"</span> <span class="op">~</span> <span class="st">"numeric"</span>,</span>
<span>      .default <span class="op">=</span> <span class="va">type</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/tee.html" class="external-link">%T&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://readr.tidyverse.org/reference/write_delim.html" class="external-link">write_csv</a></span><span class="op">(</span><span class="st">"schema.csv"</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 6 × 2</span></span>
<span><span class="co">#&gt;   name         type     </span></span>
<span><span class="co">#&gt;   &lt;chr&gt;        &lt;chr&gt;    </span></span>
<span><span class="co">#&gt; 1 Sepal.Length numeric  </span></span>
<span><span class="co">#&gt; 2 Sepal.Width  numeric  </span></span>
<span><span class="co">#&gt; 3 Petal.Length numeric  </span></span>
<span><span class="co">#&gt; 4 Petal.Width  numeric  </span></span>
<span><span class="co">#&gt; 5 Species      character</span></span>
<span><span class="co">#&gt; 6 index        numeric</span></span></code></pre></div>
<p>After updating the <code>schema.csv</code> and rendering the flow of
the pipeline, we can see that downstream targets depending on the
<code>schema.csv</code> are outdated:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">targets</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/targets/reference/tar_visnetwork.html" class="external-link">tar_visnetwork</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="visNetwork html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-e0a9896d1c11b6c5ddc3" style="width:100%;height:432.632880098888px;"></div>
<script type="application/json" data-for="htmlwidget-e0a9896d1c11b6c5ddc3">{"x":{"nodes":{"name":["data_file","input_data","is_violation","metadata_validation","schema","schema_file","get_data","validate_column_class","validation_violation","metadata_validator"],"type":["stem","stem","stem","stem","stem","stem","function","function","function","function"],"status":["uptodate","uptodate","errored","outdated","outdated","outdated","uptodate","uptodate","uptodate","uptodate"],"seconds":[0.206,0.135,0.048,0.16,0.006,0,null,null,null,null],"bytes":[4214,1597,0,5087,335,121,null,null,null,null],"branches":[null,null,null,null,null,null,null,null,null,null],"label":["data_file","input_data","is_violation","metadata_validation","schema","schema_file","get_data","validate_column_class","validation_violation","metadata_validator"],"color":["#354823","#354823","#C93312","#78B7C5","#78B7C5","#78B7C5","#354823","#354823","#354823","#354823"],"id":["data_file","input_data","is_violation","metadata_validation","schema","schema_file","get_data","validate_column_class","validation_violation","metadata_validator"],"level":[1,2,4,3,2,1,1,1,1,2],"shape":["dot","dot","dot","dot","dot","dot","triangle","triangle","triangle","triangle"]},"edges":{"from":["validate_column_class","metadata_validation","validation_violation","input_data","metadata_validator","schema","data_file","get_data","get_data","schema_file"],"to":["metadata_validator","is_violation","is_violation","metadata_validation","metadata_validation","metadata_validation","input_data","input_data","schema","schema"],"arrows":["to","to","to","to","to","to","to","to","to","to"]},"nodesToDataframe":true,"edgesToDataframe":true,"options":{"width":"100%","height":"100%","nodes":{"shape":"dot","physics":false},"manipulation":{"enabled":false},"edges":{"smooth":{"type":"cubicBezier","forceDirection":"horizontal"}},"physics":{"stabilization":false},"interaction":{"zoomSpeed":1},"layout":{"hierarchical":{"enabled":true,"direction":"LR"}}},"groups":null,"width":null,"height":null,"idselection":{"enabled":false,"style":"width: 150px; height: 26px","useLabels":true,"main":"Select by id"},"byselection":{"enabled":false,"style":"width: 150px; height: 26px","multiple":false,"hideColor":"rgba(200,200,200,0.5)","highlight":false},"main":{"text":"","style":"font-family:Georgia, Times New Roman, Times, serif;font-weight:bold;font-size:20px;text-align:center;"},"submain":null,"footer":null,"background":"rgba(0, 0, 0, 0)","highlight":{"enabled":true,"hoverNearest":false,"degree":{"from":1,"to":1},"algorithm":"hierarchical","hideColor":"rgba(200,200,200,0.5)","labelOnly":true},"collapse":{"enabled":true,"fit":false,"resetHighlight":true,"clusterOptions":null,"keepCoord":true,"labelSuffix":"(cluster)"},"legend":{"width":0.2,"useGroups":false,"position":"right","ncol":1,"stepX":100,"stepY":100,"zoom":true,"nodes":{"label":["Up to date","Errored","Outdated","Stem","Function"],"color":["#354823","#C93312","#78B7C5","#899DA4","#899DA4"],"shape":["dot","dot","dot","dot","triangle"]},"nodesToDataframe":true},"tooltipStay":300,"tooltipStyle":"position: fixed;visibility:hidden;padding: 5px;white-space: nowrap;font-family: verdana;font-size:14px;font-color:#000000;background-color: #f5f4ed;-moz-border-radius: 3px;-webkit-border-radius: 3px;border-radius: 3px;border: 1px solid #808074;box-shadow: 3px 3px 10px rgba(0, 0, 0, 0.2);"},"evals":[],"jsHooks":[]}</script><p>This time running the pipeline completes successfully, and all
unnecessary steps are skipped, which is incredibly time-efficient in
large projects:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">tar_make_catch</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; ✔ skip target data_file</span></span>
<span><span class="co">#&gt; ▶ start target schema_file</span></span>
<span><span class="co">#&gt; ● built target schema_file [0.202 seconds]</span></span>
<span><span class="co">#&gt; ✔ skip target input_data</span></span>
<span><span class="co">#&gt; ▶ start target schema</span></span>
<span><span class="co">#&gt; ● built target schema [0.134 seconds]</span></span>
<span><span class="co">#&gt; ▶ start target metadata_validation</span></span>
<span><span class="co">#&gt; ● built target metadata_validation [0.114 seconds]</span></span>
<span><span class="co">#&gt; ▶ start target is_violation</span></span>
<span><span class="co">#&gt; ● built target is_violation [0.009 seconds]</span></span>
<span><span class="co">#&gt; ▶ end pipeline [0.572 seconds]</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="error-localization-and-data-curation">Error-localization and data curation<a class="anchor" aria-label="anchor" href="#error-localization-and-data-curation"></a>
</h2>
<p>We can further add assertions on data based on particular columns and
rows. This step also usually involves adding domain knowledge assertions
on the data logic. Some common examples are:</p>
<ol style="list-style-type: decimal">
<li>Check for duplicates</li>
<li>Range of values</li>
<li>Correlation between columns</li>
<li>Pattern matching</li>
<li>Check values against code list</li>
<li>Conditional checks between variables</li>
<li>Outlier detection</li>
</ol>
<p>Using the <code>data.validator::validate_col()</code> function we
give an example of explicitly validating columns, for uniqueness,
existence of particular levels, and outliers. When particular columns
and rows are checked against some assertion the exact place where the
validation failure occurred can be tracked down using
<code><a href="../reference/get_results.html">data.validator::get_results()</a></code>. With this information at
hand it is straightforward to fix known data issues and keep track of
the data health between consequent curation steps.</p>
<p>The functions that compute the pipeline “targets” are as follows:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># R/functions.R</span></span>
<span></span>
<span><span class="co"># The namespace of the process that executes these functions is defined</span></span>
<span><span class="co"># in the `_targets.R` file where the following libraries are loaded:</span></span>
<span><span class="co">#</span></span>
<span><span class="co"># tar_option_set(</span></span>
<span><span class="co">#   packages = c("readr", "dplyr", "data.validator", "assertr", "rlang",</span></span>
<span><span class="co">#                "purrr")</span></span>
<span><span class="co"># )</span></span>
<span></span>
<span><span class="va">get_data</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">file</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">read_csv</a></span><span class="op">(</span><span class="va">file</span>, col_types <span class="op">=</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/cols.html" class="external-link">cols</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">columns_validator</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">report</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/data_validation_report.html">data_validation_report</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span>  <span class="fu"><a href="../reference/validate.html">validate</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/validate_cols.html">validate_cols</a></span><span class="op">(</span></span>
<span>      \<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://docs.ropensci.org/assertr/reference/is_uniq.html" class="external-link">is_uniq</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>,</span>
<span>      <span class="va">index</span>,</span>
<span>      description <span class="op">=</span> <span class="st">"index is unique"</span></span>
<span>    <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/validate_cols.html">validate_cols</a></span><span class="op">(</span></span>
<span>      <span class="fu"><a href="https://docs.ropensci.org/assertr/reference/in_set.html" class="external-link">in_set</a></span><span class="op">(</span><span class="st">"setosa"</span>, <span class="st">"versicolor"</span>, <span class="st">"virginica"</span><span class="op">)</span>,</span>
<span>      <span class="va">Species</span>,</span>
<span>      description <span class="op">=</span> <span class="st">"Species in set values"</span></span>
<span>    <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/validate_cols.html">validate_cols</a></span><span class="op">(</span></span>
<span>      \<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://docs.ropensci.org/assertr/reference/not_na.html" class="external-link">not_na</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>,</span>
<span>      <span class="va">Sepal.Length</span>,</span>
<span>      description <span class="op">=</span> <span class="st">"Sepal.Length not_na"</span></span>
<span>    <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/validate_cols.html">validate_cols</a></span><span class="op">(</span></span>
<span>      <span class="fu"><a href="https://docs.ropensci.org/assertr/reference/within_n_sds.html" class="external-link">within_n_sds</a></span><span class="op">(</span><span class="fl">3</span><span class="op">)</span>,</span>
<span>      <span class="va">Sepal.Width</span>,</span>
<span>      description <span class="op">=</span> <span class="st">"Sepal.Width outliers"</span></span>
<span>    <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/add_results.html">add_results</a></span><span class="op">(</span><span class="va">report</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">report</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">error_localization</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">report</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">report</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/get_results.html">get_results</a></span><span class="op">(</span>unnest <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">type</span> <span class="op">==</span> <span class="st">"error"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">index</span>, <span class="va">column</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">data_curation</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">error_indexes</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://docs.ropensci.org/targets/reference/tar_assert.html" class="external-link">tar_assert_in</a></span><span class="op">(</span><span class="st">"Sepal.Width"</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">indexes_to_change</span> <span class="op">&lt;-</span> <span class="va">error_indexes</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">column</span> <span class="op">==</span> <span class="st">"Sepal.Width"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">index</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice</a></span><span class="op">(</span><span class="va">indexes_to_change</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Sepal.Width <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html" class="external-link">median</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">Sepal.Width</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rows.html" class="external-link">rows_update</a></span><span class="op">(</span><span class="va">data</span>, <span class="va">.</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<ul>
<li><p><code>columns_validator()</code> performs assertions on
particular columns. It checks for uniqueness of the <code>index</code>
column, that all values in <code>Species</code> column are in a given
character vector, and that no outliers exist for
<code>Sepal.Width</code> using a 3 standard deviation margin.</p></li>
<li><p><code>error_localization()</code> returns the precise location of
the validation failures using the
<code><a href="../reference/get_results.html">data.validator::get_results()</a></code> function.</p></li>
<li><p><code>data_curation()</code> has input the error indexes and
performs a simple naive replacement of all validation failures in the
<code>Sepal.Width</code> column with the median.</p></li>
</ul>
<p>The <code>_targets.R</code> script looks like:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># _targets.R file</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/targets/" class="external-link">targets</a></span><span class="op">)</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/source.html" class="external-link">source</a></span><span class="op">(</span><span class="st">"R/functions.R"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://docs.ropensci.org/targets/reference/tar_option_set.html" class="external-link">tar_option_set</a></span><span class="op">(</span></span>
<span>  packages <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"readr"</span>, <span class="st">"dplyr"</span>, <span class="st">"data.validator"</span>, <span class="st">"assertr"</span>, <span class="st">"rlang"</span>,</span>
<span>               <span class="st">"purrr"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://docs.ropensci.org/targets/reference/tar_target.html" class="external-link">tar_target</a></span><span class="op">(</span><span class="va">data_file</span>, <span class="st">"data.csv"</span>, format <span class="op">=</span> <span class="st">"file"</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://docs.ropensci.org/targets/reference/tar_target.html" class="external-link">tar_target</a></span><span class="op">(</span><span class="va">input_data</span>, <span class="fu">get_data</span><span class="op">(</span><span class="va">data_file</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://docs.ropensci.org/targets/reference/tar_target.html" class="external-link">tar_target</a></span><span class="op">(</span><span class="va">validation_report</span>, <span class="fu">columns_validator</span><span class="op">(</span><span class="va">input_data</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://docs.ropensci.org/targets/reference/tar_target.html" class="external-link">tar_target</a></span><span class="op">(</span></span>
<span>    <span class="va">error_indexes</span>,</span>
<span>    <span class="fu">error_localization</span><span class="op">(</span><span class="va">validation_report</span><span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://docs.ropensci.org/targets/reference/tar_target.html" class="external-link">tar_target</a></span><span class="op">(</span></span>
<span>    <span class="va">data_curated</span>,</span>
<span>    <span class="fu">data_curation</span><span class="op">(</span><span class="va">input_data</span>, <span class="va">error_indexes</span><span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://docs.ropensci.org/targets/reference/tar_target.html" class="external-link">tar_target</a></span><span class="op">(</span></span>
<span>    <span class="va">report_after_curation</span>,</span>
<span>    <span class="fu">columns_validator</span><span class="op">(</span><span class="va">data_curated</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Displaying the dependency graph of the pipeline, clearly reveals that
the data validation step is used by the next step for
error-localization. The later “target” is passed to the data curation
step resulting to a cleansed dataset:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">targets</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/targets/reference/tar_visnetwork.html" class="external-link">tar_visnetwork</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="visNetwork html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-ca5d4ec86d43458e3d6a" style="width:100%;height:432.632880098888px;"></div>
<script type="application/json" data-for="htmlwidget-ca5d4ec86d43458e3d6a">{"x":{"nodes":{"name":["data_file","input_data","data_curated","error_indexes","report_after_curation","validation_report","error_localization","get_data","data_curation","columns_validator"],"type":["stem","stem","stem","stem","stem","stem","function","function","function","function"],"status":["uptodate","uptodate","outdated","outdated","outdated","outdated","outdated","uptodate","outdated","outdated"],"seconds":[0.206,0.135,null,null,null,null,null,null,null,null],"bytes":[4214,1597,null,null,null,null,null,null,null,null],"branches":[null,null,null,null,null,null,null,null,null,null],"label":["data_file","input_data","data_curated","error_indexes","report_after_curation","validation_report","error_localization","get_data","data_curation","columns_validator"],"color":["#354823","#354823","#78B7C5","#78B7C5","#78B7C5","#78B7C5","#78B7C5","#354823","#78B7C5","#78B7C5"],"id":["data_file","input_data","data_curated","error_indexes","report_after_curation","validation_report","error_localization","get_data","data_curation","columns_validator"],"level":[1,2,5,4,6,3,1,1,1,1],"shape":["dot","dot","dot","dot","dot","dot","triangle","triangle","triangle","triangle"]},"edges":{"from":["columns_validator","input_data","data_curation","error_indexes","input_data","data_file","get_data","error_localization","validation_report","columns_validator","data_curated"],"to":["validation_report","validation_report","data_curated","data_curated","data_curated","input_data","input_data","error_indexes","error_indexes","report_after_curation","report_after_curation"],"arrows":["to","to","to","to","to","to","to","to","to","to","to"]},"nodesToDataframe":true,"edgesToDataframe":true,"options":{"width":"100%","height":"100%","nodes":{"shape":"dot","physics":false},"manipulation":{"enabled":false},"edges":{"smooth":{"type":"cubicBezier","forceDirection":"horizontal"}},"physics":{"stabilization":false},"interaction":{"zoomSpeed":1},"layout":{"hierarchical":{"enabled":true,"direction":"LR"}}},"groups":null,"width":null,"height":null,"idselection":{"enabled":false,"style":"width: 150px; height: 26px","useLabels":true,"main":"Select by id"},"byselection":{"enabled":false,"style":"width: 150px; height: 26px","multiple":false,"hideColor":"rgba(200,200,200,0.5)","highlight":false},"main":{"text":"","style":"font-family:Georgia, Times New Roman, Times, serif;font-weight:bold;font-size:20px;text-align:center;"},"submain":null,"footer":null,"background":"rgba(0, 0, 0, 0)","highlight":{"enabled":true,"hoverNearest":false,"degree":{"from":1,"to":1},"algorithm":"hierarchical","hideColor":"rgba(200,200,200,0.5)","labelOnly":true},"collapse":{"enabled":true,"fit":false,"resetHighlight":true,"clusterOptions":null,"keepCoord":true,"labelSuffix":"(cluster)"},"legend":{"width":0.2,"useGroups":false,"position":"right","ncol":1,"stepX":100,"stepY":100,"zoom":true,"nodes":{"label":["Up to date","Outdated","Stem","Function"],"color":["#354823","#78B7C5","#899DA4","#899DA4"],"shape":["dot","dot","dot","triangle"]},"nodesToDataframe":true},"tooltipStay":300,"tooltipStyle":"position: fixed;visibility:hidden;padding: 5px;white-space: nowrap;font-family: verdana;font-size:14px;font-color:#000000;background-color: #f5f4ed;-moz-border-radius: 3px;-webkit-border-radius: 3px;border-radius: 3px;border: 1px solid #808074;box-shadow: 3px 3px 10px rgba(0, 0, 0, 0.2);"},"evals":[],"jsHooks":[]}</script><p>In addition, we emphasize in the graph above, that the function and
input file used to read the input data are the same as those in our
previous example of metadata validation, and targets saves us time and
computational resources by not importing the data again.</p>
<p>Building the pipeline:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">targets</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/targets/reference/tar_make.html" class="external-link">tar_make</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; ✔ skip target data_file</span></span>
<span><span class="co">#&gt; ✔ skip target input_data</span></span>
<span><span class="co">#&gt; ▶ start target validation_report</span></span>
<span><span class="co">#&gt; ● built target validation_report [0.162 seconds]</span></span>
<span><span class="co">#&gt; ▶ start target error_indexes</span></span>
<span><span class="co">#&gt; ● built target error_indexes [0.034 seconds]</span></span>
<span><span class="co">#&gt; ▶ start target data_curated</span></span>
<span><span class="co">#&gt; Matching, by = "Sepal.Length"</span></span>
<span><span class="co">#&gt; ● built target data_curated [0.032 seconds]</span></span>
<span><span class="co">#&gt; ▶ start target report_after_curation</span></span>
<span><span class="co">#&gt; ● built target report_after_curation [0.083 seconds]</span></span>
<span><span class="co">#&gt; ▶ end pipeline [0.625 seconds]</span></span></code></pre></div>
<p>In the beginning of this vignette we have intentionally added some
outliers in the <code>Sepal.Width</code> column. In fact these outliers
are captured in the <code>validation_report</code> return value, just
after we read the data (see also the graph above):</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">targets</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/targets/reference/tar_read.html" class="external-link">tar_read</a></span><span class="op">(</span><span class="st">"validation_report"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Validation summary: </span></span>
<span><span class="co">#&gt;  Number of successful validations: 3</span></span>
<span><span class="co">#&gt;  Number of validations with warnings: 0</span></span>
<span><span class="co">#&gt;  Number of failed validations: 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Advanced view: </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; |table_name |description           |type    | total_violations|</span></span>
<span><span class="co">#&gt; |:----------|:---------------------|:-------|----------------:|</span></span>
<span><span class="co">#&gt; |data       |Sepal.Length not_na   |success |               NA|</span></span>
<span><span class="co">#&gt; |data       |Sepal.Width outliers  |error   |                3|</span></span>
<span><span class="co">#&gt; |data       |Species in set values |success |               NA|</span></span>
<span><span class="co">#&gt; |data       |index is unique       |success |               NA|</span></span></code></pre></div>
<p>After pinpointing the precise location of the violations in the data,
the pipeline automatically replaces the hectic values in the
<code>data_curation</code> “target”. We can confirm this by examining
the results of the pipeline’s final validation phase, which in fact does
not return any incorrect observations, showing that the dataset has been
curated:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">targets</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/targets/reference/tar_read.html" class="external-link">tar_read</a></span><span class="op">(</span><span class="st">"report_after_curation"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Validation summary: </span></span>
<span><span class="co">#&gt;  Number of successful validations: 4</span></span>
<span><span class="co">#&gt;  Number of validations with warnings: 0</span></span>
<span><span class="co">#&gt;  Number of failed validations: 0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Advanced view: </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; |table_name |description           |type    | total_violations|</span></span>
<span><span class="co">#&gt; |:----------|:---------------------|:-------|----------------:|</span></span>
<span><span class="co">#&gt; |data       |Sepal.Length not_na   |success |               NA|</span></span>
<span><span class="co">#&gt; |data       |Sepal.Width outliers  |success |               NA|</span></span>
<span><span class="co">#&gt; |data       |Species in set values |success |               NA|</span></span>
<span><span class="co">#&gt; |data       |index is unique       |success |               NA|</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="summary">Summary<a class="anchor" aria-label="anchor" href="#summary"></a>
</h2>
<p>Data validation is crucial for businesses to mitigate risks
associated with erroneous data and make informed decisions. The targets
validation workflow presented in this tutorial combines the power of the
<code>targets</code> package with the <code>data.validator</code> to
ensure data reliability and accuracy, in an efficient, cost effective,
and scalable way.</p>
<p>The targets validation workflow offers several benefits. It provides
a structured framework for organizing and executing data validation
tasks, ensuring reproducibility and efficiency. By combining
<code>targets</code> with <code>data.validator</code>, the workflow can
handle complex data validation scenarios, adapt to evolving schemas, and
facilitate error localization and data curation processes.</p>
<p>Overall, this tutorial demonstrates the importance of incorporating
data validation into data pipelines and highlights how the
<code>targets</code> package and <code>data.validator</code> tool can be
leveraged to ensure reliable and accurate data for decision-making
purposes.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed with <span class="emoji" data-emoji="heart">❤️</span> by <a href="https://appsilon.com" class="external-link">Appsilon</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
